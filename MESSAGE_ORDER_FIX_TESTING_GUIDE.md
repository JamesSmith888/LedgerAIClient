# Agent æ¶ˆæ¯é¡ºåºä¿®å¤ - æµ‹è¯•æŒ‡å—

## ä¿®å¤å†…å®¹æ¦‚è§ˆ

### é—®é¢˜ 1: åæ€æ¶ˆæ¯ä¸æ˜¾ç¤º âœ… å·²ä¿®å¤
**åŸå› **: `AgentScreen.tsx` ç¡¬ç¼–ç  `enableReflection: true`ï¼Œå¿½ç•¥ç”¨æˆ·é…ç½®  
**ä¿®å¤**: è¯»å– `agentConfig.enableReflection ?? true`

### é—®é¢˜ 2: æ¶ˆæ¯é¡ºåºæ··ä¹± âœ… å·²ä¿®å¤
**åŸå› **: Stream è·¯å¾„å’Œ Callback è·¯å¾„å¹¶è¡Œæ‰§è¡Œï¼Œå¯¼è‡´ç«æ€æ¡ä»¶  
**ä¿®å¤**: å¼•å…¥åºå·æœºåˆ¶ + å»¶è¿Ÿ AI å“åº” + ç»Ÿä¸€æ’åº

---

## æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®è®¤ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `src/types/agent.ts` - æ·»åŠ  `sequence?: number` å­—æ®µ
- âœ… `src/screens/AgentScreen.tsx` - ä¿®å¤ enableReflection é…ç½®è¯»å–
- âœ… `src/context/AgentContext.tsx` - å®Œå…¨é‡æ„æ¶ˆæ¯å¤„ç†é€»è¾‘

### 2. æ¸…ç†ç¼“å­˜ï¼ˆå»ºè®®ï¼‰
```bash
cd /Users/xin.y/IdeaProjects/LedgerAIClient
rm -rf node_modules/.cache
npx react-native start --reset-cache
```

### 3. é‡æ–°ç¼–è¯‘
```bash
# iOS
npx react-native run-ios

# Android
npx react-native run-android
```

---

## æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: åŸºç¡€æ¶ˆæ¯é¡ºåºæµ‹è¯• ğŸ¯

**ç›®æ ‡**: éªŒè¯æ¶ˆæ¯æŒ‰ç…§çœŸå®æ‰§è¡Œé¡ºåºæ˜¾ç¤º

**æµ‹è¯•è¾“å…¥**:
```
ä¿®ç©ºè°ƒ50å…ƒ
```

**é¢„æœŸæ—¥å¿—è¾“å‡º**ï¼ˆæŸ¥çœ‹ Metro æ§åˆ¶å°ï¼‰:
```
ğŸ¬ [AgentContext] ========== å¼€å§‹æ–°çš„å¯¹è¯è½®æ¬¡ ==========
ğŸ“¥ [AgentContext] ç”¨æˆ·è¾“å…¥: ä¿®ç©ºè°ƒ50å…ƒ
ğŸ“¤ [AgentContext] æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ [seq=0]: user_xxx
ğŸ¤– [AgentContext] æ·»åŠ  AI å ä½ç¬¦: assistant_xxx
ğŸš€ [AgentContext] Starting stream execution...

ğŸ¤” [AgentContext] Thinking start [seq=1]
   æˆ‘æ¥å¸®æ‚¨è®°å½•è¿™ç¬”ä¿®ç©ºè°ƒçš„æ”¯å‡º...

ğŸ”§ [AgentContext] Tool call [seq=2]: category
   Args: {"action":"search","keyword":"ç»´ä¿®","type":"EXPENSE"}

âœ… [AgentContext] Tool result: category
   Result: æ‰¾åˆ°åŒ¹é…çš„åˆ†ç±»

ğŸ”§ [AgentContext] Tool call [seq=3]: transaction
   Args: {"action":"create",...}

âœ… [AgentContext] Tool result: transaction
   Result: äº¤æ˜“åˆ›å»ºæˆåŠŸ

ğŸ”§ [AgentContext] Tool call [seq=4]: render_transaction_detail
   Args: {"id":464,...}

ğŸ¨ [AgentContext] Embedded content [seq=5]: render_transaction_detail

âœ… [AgentContext] Tool result: render_transaction_detail
   Result: âœ… å·²æ¸²æŸ“

âœ… [AgentContext] Stream completed. Total chunks: 5

ğŸ’¬ [AgentContext] Final AI response [seq=6]: å·²æˆåŠŸè®°å½•ä¸€ç¬”ä¿®ç©ºè°ƒçš„æ”¯å‡º...

ğŸ [AgentContext] Finalizing...
ğŸ“Š [AgentContext] Final message count: 7
ğŸ“Š [AgentContext] Message order:
   [0] text â†’ [1] thinking â†’ [2] tool_call â†’ [2] tool_result â†’
   [3] tool_call â†’ [3] tool_result â†’ [4] tool_call â†’ [5] embedded â†’
   [4] tool_result â†’ [6] text

ğŸ¬ [AgentContext] ========== å¯¹è¯è½®æ¬¡ç»“æŸ ==========
```

**é¢„æœŸç•Œé¢æ˜¾ç¤º**ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç”¨æˆ·æ°”æ³¡]                                  â”‚
â”‚ ä¿®ç©ºè°ƒ50å…ƒ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ€è€ƒæ°”æ³¡ - æµ…è‰²å°å­—]                        â”‚
â”‚ ğŸ¤” æˆ‘æ¥å¸®æ‚¨è®°å½•è¿™ç¬”ä¿®ç©ºè°ƒçš„æ”¯å‡º...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å·¥å…·è°ƒç”¨æ°”æ³¡]                              â”‚
â”‚ ğŸ”§ åˆ†ç±»ç®¡ç† - æœç´¢åˆ†ç±»                       â”‚
â”‚ å‚æ•°: {"keyword": "ç»´ä¿®", ...}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å·¥å…·ç»“æœæ°”æ³¡]                              â”‚
â”‚ âœ… å·²å®Œæˆ - æ‰¾åˆ°åŒ¹é…çš„åˆ†ç±»                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å·¥å…·è°ƒç”¨æ°”æ³¡]                              â”‚
â”‚ ğŸ”§ äº¤æ˜“ç®¡ç† - åˆ›å»ºäº¤æ˜“                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å·¥å…·ç»“æœæ°”æ³¡]                              â”‚
â”‚ âœ… å·²å®Œæˆ - äº¤æ˜“åˆ›å»ºæˆåŠŸ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å·¥å…·è°ƒç”¨æ°”æ³¡]                              â”‚
â”‚ ğŸ”§ æ¸²æŸ“äº¤æ˜“è¯¦æƒ…                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [äº¤æ˜“è¯¦æƒ…å¡ç‰‡ - åµŒå…¥å†…å®¹]                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚ â•‘  ä¿®ç©ºè°ƒ                               â•‘   â”‚
â”‚ â•‘  -Â¥50.00                              â•‘   â”‚
â”‚ â•‘  æ•°ç ç»´ä¿® Â· 2025-12-12                â•‘   â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [AI æ°”æ³¡ - æ­£å¸¸å­—ä½“]                        â”‚
â”‚ å·²æˆåŠŸè®°å½•ä¸€ç¬”ä¿®ç©ºè°ƒçš„æ”¯å‡ºï¼Œé‡‘é¢50å…ƒï¼Œ       â”‚
â”‚ åˆ†ç±»ä¸º"æ•°ç ç»´ä¿®"ï¼Œäº¤æ˜“IDä¸º464ã€‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆä¿®å¤å‰ï¼‰**:
```
[ç”¨æˆ·] ä¿®ç©ºè°ƒ50å…ƒ
[AI] å·²æˆåŠŸè®°å½•ä¸€ç¬”ä¿®ç©ºè°ƒçš„æ”¯å‡º...  â¬…ï¸ é”™è¯¯ï¼è¿‡æ—©æ˜¾ç¤º
[å·¥å…·è°ƒç”¨] åˆ†ç±»ç®¡ç†                  â¬…ï¸ åº”è¯¥åœ¨ AI å“åº”ä¹‹å‰
[å·¥å…·ç»“æœ] âœ… å·²å®Œæˆ
[å·¥å…·è°ƒç”¨] äº¤æ˜“ç®¡ç†
[å·¥å…·ç»“æœ] âœ… å·²å®Œæˆ
```

---

### åœºæ™¯ 2: åæ€æ¶ˆæ¯æ˜¾ç¤ºæµ‹è¯• ğŸ’­

**ç›®æ ‡**: éªŒè¯åæ€æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º

**æ­¥éª¤**:
1. è¿›å…¥ Agent é…ç½®ç•Œé¢
2. å¯ç”¨åæ€æ¨¡å¼ï¼ˆReflectionï¼‰
3. è®¾ç½®åæ€é¢‘ç‡ä¸º"æ¯æ¬¡æ‰§è¡Œ"

**æµ‹è¯•è¾“å…¥**:
```
ä»Šå¤©ä¸­åˆåƒäº†éº»è¾£çƒ«35å…ƒ
```

**é¢„æœŸæ—¥å¿—è¾“å‡º**:
```
ğŸ’­ [AgentContext] Reflection [seq=N]:
   confidence=0.95
   thought=æˆ‘æˆåŠŸè®°å½•äº†ä¸€ç¬”é¤é¥®æ”¯å‡º...
   improvements=å¯ä»¥åœ¨æœªæ¥è¯¢é—®ç”¨æˆ·é¤é¥®é¢„ç®—...
```

**é¢„æœŸç•Œé¢æ˜¾ç¤º**:
- åœ¨æœ€ç»ˆ AI å“åº”ä¹‹å‰ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªåæ€æ°”æ³¡
- åæ€æ°”æ³¡åº”è¯¥æ˜¯**æµ…è‰²å°å­—ä½“**
- åŒ…å« ğŸ’­ å›¾æ ‡
- æ˜¾ç¤ºä¿¡å¿ƒæŒ‡æ•°æ¡

**ç¤ºä¾‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [åæ€æ°”æ³¡ - æµ…è‰²å°å­—]                        â”‚
â”‚ ğŸ’­ åæ€ç»“æœ                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚ ä¿¡å¿ƒæŒ‡æ•°: 95% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 â”‚
â”‚                                            â”‚
â”‚ æˆ‘æˆåŠŸè®°å½•äº†ä¸€ç¬”é¤é¥®æ”¯å‡ºï¼Œåˆ†ç±»æ­£ç¡®ï¼Œ         â”‚
â”‚ é‡‘é¢åˆç†ã€‚å¯ä»¥åœ¨æœªæ¥è¯¢é—®ç”¨æˆ·é¤é¥®é¢„ç®—...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### åœºæ™¯ 3: å¤šå·¥å…·è°ƒç”¨å¤æ‚åœºæ™¯ ğŸ”§

**ç›®æ ‡**: éªŒè¯å¤šä¸ªå·¥å…·è°ƒç”¨åœºæ™¯ä¸‹çš„æ¶ˆæ¯é¡ºåº

**æµ‹è¯•è¾“å…¥**:
```
æŸ¥è¯¢æˆ‘æœ¬æœˆçš„æ•°ç äº§å“æ”¯å‡º
```

**é¢„æœŸæµç¨‹**:
1. ç”¨æˆ·æ¶ˆæ¯
2. æ€è€ƒä¸­...
3. å·¥å…·è°ƒç”¨ï¼šåˆ†ç±»ç®¡ç†ï¼ˆæœç´¢"æ•°ç "åˆ†ç±»ï¼‰
4. å·¥å…·ç»“æœ
5. å·¥å…·è°ƒç”¨ï¼šäº¤æ˜“ç®¡ç†ï¼ˆæŸ¥è¯¢æœ¬æœˆäº¤æ˜“ï¼‰
6. å·¥å…·ç»“æœ
7. å·¥å…·è°ƒç”¨ï¼šç»Ÿè®¡åˆ†æï¼ˆè®¡ç®—æ€»é¢ï¼‰
8. å·¥å…·ç»“æœ
9. åµŒå…¥å†…å®¹ï¼šç»Ÿè®¡å¡ç‰‡
10. åæ€ï¼ˆå¦‚æœå¯ç”¨ï¼‰
11. AI æœ€ç»ˆå“åº”

**éªŒè¯è¦ç‚¹**:
- âœ… æ¯ä¸ªå·¥å…·è°ƒç”¨åå¿…é¡»æœ‰å¯¹åº”çš„å·¥å…·ç»“æœ
- âœ… å·¥å…·ç»“æœå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå·¥å…·è°ƒç”¨ä¹‹å‰
- âœ… AI æœ€ç»ˆå“åº”å¿…é¡»åœ¨æ‰€æœ‰å·¥å…·å®Œæˆå
- âœ… åºå·ä¸¥æ ¼é€’å¢ï¼šseq=0, 1, 2, 3, 4, 5...

---

### åœºæ™¯ 4: é”™è¯¯å¤„ç†åœºæ™¯ âŒ

**ç›®æ ‡**: éªŒè¯é”™è¯¯æƒ…å†µä¸‹çš„æ¶ˆæ¯é¡ºåº

**æµ‹è¯•è¾“å…¥**:
```
åˆ›å»ºä¸€ç¬”é‡‘é¢ä¸º abcd çš„äº¤æ˜“
```

**é¢„æœŸè¡Œä¸º**:
1. ç”¨æˆ·æ¶ˆæ¯
2. æ€è€ƒä¸­...
3. å·¥å…·è°ƒç”¨ï¼šäº¤æ˜“ç®¡ç†ï¼ˆå‚æ•°é”™è¯¯ï¼‰
4. å·¥å…·ç»“æœï¼šâŒ é”™è¯¯ - é‡‘é¢æ ¼å¼ä¸æ­£ç¡®
5. åæ€ï¼ˆåº”è¯¥åœ¨é”™è¯¯åè§¦å‘ï¼‰
6. AI å“åº”ï¼šæŠ±æ­‰ï¼Œé‡‘é¢æ ¼å¼ä¸æ­£ç¡®...

**éªŒè¯è¦ç‚¹**:
- âœ… é”™è¯¯æ¶ˆæ¯åº”è¯¥æ­£ç¡®æ˜¾ç¤º
- âœ… åæ€åº”è¯¥åœ¨é”™è¯¯åè§¦å‘ï¼ˆå¦‚æœå¯ç”¨ on_errorï¼‰
- âœ… æ¶ˆæ¯é¡ºåºä¸è¢«é”™è¯¯æ‰“ä¹±

---

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

æ‰“å¼€ Metro æ§åˆ¶å°ï¼Œæœç´¢ä»¥ä¸‹å…³é”®å­—ï¼š

- `ğŸ¬` - å¯¹è¯å¼€å§‹/ç»“æŸ
- `ğŸ“¥` - ç”¨æˆ·è¾“å…¥
- `ğŸ¤”` - æ€è€ƒæ¶ˆæ¯
- `ğŸ”§` - å·¥å…·è°ƒç”¨
- `âœ…` - å·¥å…·ç»“æœ
- `ğŸ¨` - åµŒå…¥å†…å®¹
- `ğŸ’¬` - AI æœ€ç»ˆå“åº”
- `ğŸ“Š` - æ¶ˆæ¯é¡ºåºç»Ÿè®¡

### 2. æŸ¥çœ‹åºå·åˆ†é…

åœ¨ finally å—ä¸­ä¼šè¾“å‡ºå®Œæ•´çš„æ¶ˆæ¯é¡ºåºï¼š
```
ğŸ“Š [AgentContext] Message order: [0] text â†’ [1] thinking â†’ [2] tool_call â†’ ...
```

æ£€æŸ¥ï¼š
- åºå·æ˜¯å¦é€’å¢
- æ˜¯å¦æœ‰é‡å¤åºå·
- æœ€ç»ˆ AI å“åº”æ˜¯å¦æœ‰æœ€å¤§çš„åºå·

### 3. æ£€æŸ¥æ—¶é—´æˆ³

æ¯æ¡æ—¥å¿—éƒ½æœ‰æ—¶é—´æˆ³ï¼Œå¯ä»¥éªŒè¯ï¼š
- æ¶ˆæ¯ç”Ÿæˆçš„å®é™…æ—¶é—´é¡ºåº
- å·¥å…·è°ƒç”¨çš„è€—æ—¶
- æ˜¯å¦æœ‰æ˜æ˜¾çš„å»¶è¿Ÿ

### 4. ä½¿ç”¨ React DevTools

æŸ¥çœ‹ `messages` çŠ¶æ€ï¼š
```javascript
messages.forEach(m => console.log(`[${m.sequence}] ${m.type}: ${m.content.substring(0, 30)}`));
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: æ¶ˆæ¯é¡ºåºè¿˜æ˜¯ä¸å¯¹ï¼Ÿ

**æ£€æŸ¥ç‚¹**:
1. âœ… ç¡®è®¤ `agent.ts` ä¸­ `AgentMessage` æœ‰ `sequence?: number` å­—æ®µ
2. âœ… ç¡®è®¤ `AgentContext.tsx` ä¸­ `messageSequence` è®¡æ•°å™¨æ­£å¸¸å·¥ä½œ
3. âœ… æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ¯æ¡æ¶ˆæ¯éƒ½åˆ†é…äº†åºå·
4. âœ… ç¡®è®¤ finally å—ä¸­çš„æ’åºé€»è¾‘æ­£ç¡®æ‰§è¡Œ

**è°ƒè¯•æ–¹æ³•**:
```typescript
// åœ¨ AgentContext.tsx çš„ finally å—ä¸­æ·»åŠ ï¼š
console.log('ğŸ” Before sort:', prev.map(m => `[${m.sequence}] ${m.type}`));
filtered.sort((a, b) => (a.sequence ?? 999999) - (b.sequence ?? 999999));
console.log('ğŸ” After sort:', filtered.map(m => `[${m.sequence}] ${m.type}`));
```

### Q2: åæ€æ¶ˆæ¯ä¸æ˜¾ç¤ºï¼Ÿ

**æ£€æŸ¥ç‚¹**:
1. âœ… ç¡®è®¤ Agent é…ç½®ä¸­ `enableReflection` ä¸º `true`
2. âœ… ç¡®è®¤åæ€é¢‘ç‡è®¾ç½®æ­£ç¡®ï¼ˆevery_step / on_error / on_completionï¼‰
3. âœ… æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰ `ğŸ’­ [AgentContext] Reflection` è¾“å‡º
4. âœ… ç¡®è®¤ `MessageBubble.tsx` ä¸­åæ€æ¸²æŸ“é€»è¾‘æ­£å¸¸

**è°ƒè¯•æ–¹æ³•**:
```typescript
// åœ¨ onReflection å›è°ƒä¸­æ·»åŠ ï¼š
console.log('ğŸ’­ Reflection received:', {
  sequence: seq,
  thought: result.thought.substring(0, 50),
  confidence: result.confidence,
});
```

### Q3: AI å“åº”æ¶ˆå¤±äº†ï¼Ÿ

**æ£€æŸ¥ç‚¹**:
1. âœ… ç¡®è®¤ stream å¾ªç¯æ­£ç¡®æ”¶é›†å†…å®¹
2. âœ… ç¡®è®¤ finally å—ä¸­æ·»åŠ äº†æœ€ç»ˆå“åº”
3. âœ… æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰ `ğŸ’¬ Final AI response` è¾“å‡º

**è°ƒè¯•æ–¹æ³•**:
```typescript
// åœ¨ stream å¾ªç¯åæ·»åŠ ï¼š
console.log('ğŸ’¬ Final content collected:', finalContent?.substring(0, 100));
console.log('ğŸ’¬ Will add with sequence:', getNextSequence());
```

### Q4: å·¥å…·ç»“æœå’Œè°ƒç”¨å¯¹ä¸ä¸Šï¼Ÿ

**æ£€æŸ¥ç‚¹**:
1. âœ… ç¡®è®¤æ¯ä¸ª tool_call éƒ½æœ‰å¯¹åº”çš„ tool_result
2. âœ… æ£€æŸ¥ toolName æ˜¯å¦åŒ¹é…
3. âœ… ç¡®è®¤åºå·è¿ç»­ï¼ˆtool_call: seq=N, tool_result: seq=N+1ï¼‰

**è°ƒè¯•æ–¹æ³•**:
```typescript
// ç»Ÿè®¡å·¥å…·æ¶ˆæ¯ï¼š
const toolCalls = messages.filter(m => m.type === 'tool_call');
const toolResults = messages.filter(m => m.type === 'tool_result');
console.log('ğŸ”§ Tool calls:', toolCalls.length);
console.log('âœ… Tool results:', toolResults.length);
```

---

## æ€§èƒ½ç›‘æ§

### æ¶ˆæ¯æ•°é‡ç»Ÿè®¡

åœ¨å¯¹è¯ç»“æŸæ—¶ï¼Œæ—¥å¿—ä¼šè¾“å‡ºï¼š
```
ğŸ“Š [AgentContext] Final message count: 7
```

å…¸å‹åœºæ™¯çš„æ¶ˆæ¯æ•°é‡ï¼š
- ç®€å•è®°è´¦ï¼š5-8 æ¡ï¼ˆç”¨æˆ· + æ€è€ƒ + 2-3 ä¸ªå·¥å…· + AIï¼‰
- å¤æ‚æŸ¥è¯¢ï¼š8-15 æ¡ï¼ˆå¤šä¸ªå·¥å…·è°ƒç”¨ + ç»Ÿè®¡å¡ç‰‡ï¼‰
- é”™è¯¯å¤„ç†ï¼š6-10 æ¡ï¼ˆåŒ…å«é”™è¯¯åæ€ï¼‰

### æ‰§è¡Œæ—¶é—´

è§‚å¯Ÿä»¥ä¸‹æ—¶é—´ç‚¹ï¼š
- `ğŸ¬ å¼€å§‹` åˆ° `ğŸš€ Starting stream` - å‡†å¤‡æ—¶é—´
- `ğŸš€ Starting stream` åˆ° `âœ… Stream completed` - æ¨¡å‹æ‰§è¡Œæ—¶é—´
- `âœ… Stream completed` åˆ° `ğŸ Finalizing` - åå¤„ç†æ—¶é—´
- `ğŸ Finalizing` åˆ° `ğŸ¬ ç»“æŸ` - æ’åºå’Œæ¸²æŸ“æ—¶é—´

æ­£å¸¸èŒƒå›´ï¼š
- å‡†å¤‡æ—¶é—´ï¼š< 100ms
- æ¨¡å‹æ‰§è¡Œï¼š1-5 ç§’ï¼ˆå–å†³äºå·¥å…·æ•°é‡ï¼‰
- åå¤„ç†ï¼š< 200ms
- æ’åºæ¸²æŸ“ï¼š< 100ms

---

## å›å½’æµ‹è¯•æ¸…å•

æµ‹è¯•æ‰€æœ‰åœºæ™¯åï¼Œç¡®è®¤ï¼š

### åŠŸèƒ½æµ‹è¯•
- [ ] ç®€å•è®°è´¦ï¼ˆä¿®ç©ºè°ƒ50å…ƒï¼‰
- [ ] å¤æ‚æŸ¥è¯¢ï¼ˆæœ¬æœˆæ•°ç äº§å“æ”¯å‡ºï¼‰
- [ ] å¤šåˆ†ç±»æœç´¢
- [ ] é¢„ç®—æŸ¥è¯¢
- [ ] é”™è¯¯è¾“å…¥å¤„ç†
- [ ] å–æ¶ˆæ“ä½œ

### æ¶ˆæ¯é¡ºåºæµ‹è¯•
- [ ] ç”¨æˆ·æ¶ˆæ¯å§‹ç»ˆç¬¬ä¸€
- [ ] æ€è€ƒæ¶ˆæ¯åœ¨å·¥å…·è°ƒç”¨å‰
- [ ] å·¥å…·è°ƒç”¨å’Œç»“æœæˆå¯¹å‡ºç°
- [ ] åµŒå…¥å†…å®¹åœ¨å¯¹åº”å·¥å…·ç»“æœå
- [ ] åæ€åœ¨å·¥å…·å®Œæˆåï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] AI å“åº”å§‹ç»ˆæœ€å

### åæ€åŠŸèƒ½æµ‹è¯•
- [ ] åæ€å¼€å…³ç”Ÿæ•ˆ
- [ ] åæ€é¢‘ç‡è®¾ç½®ç”Ÿæ•ˆ
- [ ] åæ€æ¶ˆæ¯æ ·å¼æ­£ç¡®ï¼ˆæµ…è‰²å°å­—ï¼‰
- [ ] ä¿¡å¿ƒæŒ‡æ•°æ˜¾ç¤º
- [ ] åæ€å†…å®¹å¯è¯»

### æ€§èƒ½æµ‹è¯•
- [ ] æ¶ˆæ¯æ¸²æŸ“æµç•…
- [ ] æ— æ˜æ˜¾å¡é¡¿
- [ ] æ—¥å¿—è¾“å‡ºä¸å½±å“æ€§èƒ½
- [ ] é•¿å¯¹è¯ä¸å´©æºƒ

---

## æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## æµ‹è¯•æ—¥æœŸï¼š2025-12-12

### æµ‹è¯•ç¯å¢ƒ
- è®¾å¤‡ï¼šiPhone 15 Pro / Pixel 7
- OS ç‰ˆæœ¬ï¼šiOS 17.2 / Android 14
- React Native ç‰ˆæœ¬ï¼š0.73.2

### æµ‹è¯•ç»“æœ

#### åœºæ™¯ 1: åŸºç¡€æ¶ˆæ¯é¡ºåº
- çŠ¶æ€ï¼šâœ… / âŒ
- æè¿°ï¼š
- æˆªå›¾ï¼š

#### åœºæ™¯ 2: åæ€æ¶ˆæ¯æ˜¾ç¤º
- çŠ¶æ€ï¼šâœ… / âŒ
- æè¿°ï¼š
- æˆªå›¾ï¼š

#### åœºæ™¯ 3: å¤šå·¥å…·è°ƒç”¨
- çŠ¶æ€ï¼šâœ… / âŒ
- æè¿°ï¼š
- æˆªå›¾ï¼š

#### åœºæ™¯ 4: é”™è¯¯å¤„ç†
- çŠ¶æ€ï¼šâœ… / âŒ
- æè¿°ï¼š
- æˆªå›¾ï¼š

### å‘ç°çš„é—®é¢˜
1. 
2. 
3. 

### å»ºè®®æ”¹è¿›
1. 
2. 
3. 
```

---

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆä¸‹ä¸ªç‰ˆæœ¬ï¼‰
1. **æ—¥å¿—å¼€å…³**ï¼šæ·»åŠ  `enableDebugLogs` é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå…³é—­è¯¦ç»†æ—¥å¿—
2. **æ€§èƒ½ç›‘æ§**ï¼šæ·»åŠ æ¶ˆæ¯å¤„ç†è€—æ—¶ç»Ÿè®¡
3. **é”™è¯¯ä¸ŠæŠ¥**ï¼šåºå·å†²çªæ—¶ä¸ŠæŠ¥è­¦å‘Š

### ä¸­æœŸä¼˜åŒ–ï¼ˆ2-3 ä¸ªç‰ˆæœ¬ï¼‰
1. **æµå¼ AI å“åº”**ï¼šä¸º AI æ–‡æœ¬åˆ›å»ºä¸´æ—¶æ¶ˆæ¯ï¼Œä¿ç•™æµå¼ä½“éªŒ
2. **æ¶ˆæ¯åˆ†ç»„**ï¼šåŒä¸€è½®æ¬¡çš„å·¥å…·è°ƒç”¨å¯æŠ˜å æ˜¾ç¤º
3. **å†å²æ¶ˆæ¯ä¼˜åŒ–**ï¼šé•¿å¯¹è¯çš„æ¶ˆæ¯è™šæ‹ŸåŒ–æ¸²æŸ“

### é•¿æœŸä¼˜åŒ–ï¼ˆ3+ ä¸ªç‰ˆæœ¬ï¼‰
1. **æ¶ˆæ¯æŒä¹…åŒ–**ï¼šåºå·ä¿å­˜åˆ°æ•°æ®åº“ï¼Œåˆ·æ–°åé¡ºåºä¸å˜
2. **å›æ”¾åŠŸèƒ½**ï¼šåŸºäºåºå·é‡ç°å®Œæ•´çš„æ‰§è¡Œè¿‡ç¨‹
3. **æ€§èƒ½åˆ†æ**ï¼šåŸºäºæ—¥å¿—ç”Ÿæˆæ‰§è¡Œæ—¶é—´çº¿å›¾

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-12-12  
**ç»´æŠ¤è€…**: Agent Architecture Team
