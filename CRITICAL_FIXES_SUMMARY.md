# å…³é”®é—®é¢˜ä¿®å¤æ€»ç»“

æœ¬æ¬¡ä¿®å¤è§£å†³äº†ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼Œæ‰€æœ‰é—®é¢˜å‡å·²å®Œæˆã€‚

## 1. âœ… å¯¹è¯è®°å¿†æ³„éœ²é—®é¢˜ï¼ˆä¸¥é‡é—®é¢˜ï¼‰

### é—®é¢˜æè¿°
æ–°å¯¹è¯ä¾æ—§ä¿ç•™ä¸Šä¸€æ¬¡å¯¹è¯çš„è®°å¿†ï¼Œå¯¼è‡´ï¼š
- AI èƒ½å¤Ÿ"è®°ä½"ä¸åº”è¯¥çŸ¥é“çš„äº¤æ˜“è¯¦æƒ…
- æµªè´¹ç”¨æˆ·çš„ token
- ä¸Šä¸‹æ–‡æ±¡æŸ“å½±å“å“åº”è´¨é‡

### æ ¹æœ¬åŽŸå› 
ä¹‹å‰çš„ä¿®å¤åªè°ƒç”¨äº† `agentRef.current?.reset()`ï¼Œè¿™åªèƒ½é‡ç½® Agent çš„å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚ `completedStepObservations`ã€`currentUserRequest` ç­‰ï¼‰ï¼Œä½†**æ— æ³•æ¸…é™¤ LangChain æ¨¡åž‹å®žä¾‹å†…éƒ¨å¯èƒ½å­˜åœ¨çš„ç¼“å­˜**ã€‚

LangChain çš„æ¨¡åž‹å®žä¾‹å¯èƒ½ä¼šç¼“å­˜ï¼š
- ä¹‹å‰çš„ system prompt ä¸Šä¸‹æ–‡
- å·¥å…·è°ƒç”¨åŽ†å²
- å†…éƒ¨ä¼˜åŒ–çŠ¶æ€

### è§£å†³æ–¹æ¡ˆ
**å®Œå…¨é‡æ–°åˆ›å»º Agent å®žä¾‹**ï¼Œé€šè¿‡é€’å¢ž `modelConfigVersion` å¼ºåˆ¶è§¦å‘ `useEffect` ä¾èµ–ï¼Œå®Œå…¨é‡å»º Agentã€‚

### ä¿®æ”¹æ–‡ä»¶
[src/context/AgentContext.tsx](src/context/AgentContext.tsx#L493-L503)

```typescript
// ðŸ”¥ å…³é”®ä¿®å¤ï¼šå®Œå…¨é‡æ–°åˆ›å»º Agent å®žä¾‹ä»¥æ¸…é™¤ LLM å†…éƒ¨ç¼“å­˜
// ä»…è°ƒç”¨ reset() æ— æ³•æ¸…é™¤ LangChain æ¨¡åž‹å®žä¾‹ä¸­å¯èƒ½å­˜åœ¨çš„ç¼“å­˜çŠ¶æ€
// é€šè¿‡é€’å¢žç‰ˆæœ¬å·å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–ï¼Œç¡®ä¿æ¯æ¬¡åˆ‡æ¢å¯¹è¯éƒ½æœ‰å…¨æ–°çš„ä¸Šä¸‹æ–‡
setModelConfigVersion(prev => prev + 1);
```

### éªŒè¯æ–¹æ³•
1. åœ¨å¯¹è¯ A ä¸­è®°å½•ä¸€ç¬”äº¤æ˜“ï¼ˆä¾‹å¦‚ï¼š"è®°ä¸€ç¬”åˆé¤ 15 å…ƒ"ï¼‰
2. åˆ‡æ¢åˆ°æ–°å¯¹è¯ B
3. ç›´æŽ¥é—®ï¼š"æˆ‘åˆšæ‰è®°å½•äº†ä»€ä¹ˆï¼Ÿ"
4. AI åº”è¯¥å›žå¤ä¸çŸ¥é“ï¼Œè€Œä¸æ˜¯è¯´"æ‚¨è®°å½•äº†åˆé¤ 15 å…ƒ"

---

## 2. âœ… Agent æ‚¬æµ®æŒ‰é’®å¯æ‹–åŠ¨åŠŸèƒ½

### é—®é¢˜æè¿°
Agent åŽå°è¿›åº¦å°çª—å£ä½ç½®å›ºå®šï¼Œå¯èƒ½é®æŒ¡å…¶ä»– UI å…ƒç´ ï¼Œç”¨æˆ·æ— æ³•è°ƒæ•´ä½ç½®ã€‚

### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ React Native çš„ `PanResponder` API å®žçŽ°æ‹–åŠ¨åŠŸèƒ½ï¼š
- **é•¿æŒ‰æ‹–åŠ¨**ï¼šç”¨æˆ·å¯ä»¥æŒ‰ä½æŒ‰é’®æ‹–åŠ¨åˆ°ä»»æ„ä½ç½®
- **è½»è§¦è§¦å‘**ï¼šæ‹–åŠ¨è·ç¦»å°äºŽ 10px è§†ä¸ºç‚¹å‡»ï¼Œå¯¼èˆªåˆ° Agent é¡µé¢
- **è¾¹ç•Œé™åˆ¶**ï¼šé˜²æ­¢æŒ‰é’®è¢«æ‹–å‡ºå±å¹•
- **å¹³æ»‘å¸é™„**ï¼šæ¾æ‰‹åŽè‡ªåŠ¨å¸é™„åˆ°è¾¹ç•Œå†…çš„åˆç†ä½ç½®
- **æ‹–åŠ¨åé¦ˆ**ï¼šæ‹–åŠ¨æ—¶é€æ˜Žåº¦é™ä½Žåˆ° 0.7

### ä¿®æ”¹æ–‡ä»¶
[src/components/agent/AgentFloatingButton.tsx](src/components/agent/AgentFloatingButton.tsx)

### å…³é”®ä»£ç 
```typescript
// æ‹–åŠ¨ä½ç½®çŠ¶æ€
const pan = useRef(new Animated.ValueXY({ x: Spacing.md, y: SCREEN_HEIGHT - 200 })).current;
const [isDragging, setIsDragging] = useState(false);

// PanResponder é…ç½®
const panResponder = useRef(
  PanResponder.create({
    onStartShouldSetPanResponder: () => true,
    onMoveShouldSetPanResponder: () => true,
    onPanResponderGrant: () => {
      setIsDragging(true);
      // ä¿å­˜å½“å‰ä½ç½®
    },
    onPanResponderMove: Animated.event([null, { dx: pan.x, dy: pan.y }]),
    onPanResponderRelease: (_, gesture) => {
      // åˆ¤æ–­æ˜¯ç‚¹å‡»è¿˜æ˜¯æ‹–åŠ¨
      if (Math.abs(gesture.dx) < 10 && Math.abs(gesture.dy) < 10) {
        handlePress();  // ç‚¹å‡»è¡Œä¸º
      } else {
        // è¾¹ç•Œé™åˆ¶ + å¹³æ»‘å¸é™„
      }
    },
  })
).current;
```

### ä½¿ç”¨æ–¹å¼
1. **æ‹–åŠ¨**ï¼šé•¿æŒ‰æŒ‰é’®ï¼Œæ‹–åŠ¨åˆ°ç›®æ ‡ä½ç½®åŽæ¾æ‰‹
2. **ç‚¹å‡»**ï¼šè½»è§¦æŒ‰é’®ï¼ˆä¸æ‹–åŠ¨ï¼‰å¯¼èˆªåˆ° Agent é¡µé¢

---

## 3. âœ… å¼ºåˆ¶è¾“å‡ºæ™ºèƒ½å»ºè®®

### é—®é¢˜æè¿°
æ™ºèƒ½å»ºè®®åŠŸèƒ½è™½ç„¶æœ‰å¼€å…³ï¼Œä½†æ¨¡åž‹ä¼šè‡ªè¡Œå†³ç­–æ˜¯å¦è¾“å‡ºå»ºè®®ï¼Œå¯¼è‡´ï¼š
- ç”¨æˆ·å¼€å¯äº†å»ºè®®åŠŸèƒ½ï¼Œä½†æ¨¡åž‹ä¸æ€»æ˜¯æä¾›
- ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´

### è§£å†³æ–¹æ¡ˆ
åœ¨ç³»ç»Ÿæç¤ºè¯ä¸­å¢žåŠ å¼ºåˆ¶è¦æ±‚ï¼Œæ˜Žç¡®å‘ŠçŸ¥æ¨¡åž‹**å¿…é¡»**åœ¨æ¯æ¬¡æ¸²æŸ“ç»“æžœæ—¶æä¾› 2-4 ä¸ªæ™ºèƒ½å»ºè®®ã€‚

### ä¿®æ”¹æ–‡ä»¶
[src/agent/statefulAgent.ts](src/agent/statefulAgent.ts#L163-L171)

### ä¿®æ”¹å†…å®¹
åœ¨ç³»ç»Ÿæç¤ºè¯çš„è¡Œä¸ºè§„èŒƒä¸­å¢žåŠ ç¬¬ 7 æ¡ï¼š

```typescript
7. **ðŸ’¡ æ™ºèƒ½å»ºè®®ï¼ˆé‡è¦ï¼‰**ï¼šåœ¨æ¯æ¬¡ä½¿ç”¨æ¸²æŸ“å·¥å…·å±•ç¤ºç»“æžœæ—¶ï¼Œ**å¿…é¡»**åœ¨ suggestedActions å‚æ•°ä¸­æä¾› 2-4 ä¸ªåŽç»­æ“ä½œå»ºè®®ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®Œæˆç›¸å…³ä»»åŠ¡ã€‚å»ºè®®åº”è¯¥å…·ä½“ã€å¯æ“ä½œï¼Œä¸è¦è¿‡äºŽæ³›æ³›
```

### æ•ˆæžœ
- æ¨¡åž‹ä¼šåœ¨æ‰€æœ‰æ”¯æŒ `suggestedActions` çš„æ¸²æŸ“å·¥å…·ä¸­è‡ªåŠ¨æä¾›å»ºè®®
- å»ºè®®æ•°é‡ï¼š2-4 ä¸ª
- å»ºè®®è´¨é‡ï¼šå…·ä½“ã€å¯æ“ä½œï¼Œè´´åˆå½“å‰ä¸Šä¸‹æ–‡

### ç¤ºä¾‹
ç”¨æˆ·æŸ¥è¯¢ï¼š"åˆ†æžæˆ‘çš„å¼€æ”¯"

AI å“åº”ä¼šåŒ…å«ï¼š
```json
{
  "suggestedActions": [
    { "label": "æŸ¥çœ‹è¯¦ç»†äº¤æ˜“è®°å½•", "message": "æŸ¥çœ‹12æœˆ1æ—¥åˆ°12æœˆ12æ—¥çš„æ‰€æœ‰äº¤æ˜“è®°å½•" },
    { "label": "åˆ†æžæ”¶å…¥æƒ…å†µ", "message": "åˆ†æžæˆ‘çš„æ”¶å…¥æƒ…å†µ" },
    { "label": "è®¾ç½®é¢„ç®—", "message": "è®¾ç½®æœˆåº¦é¢„ç®—" }
  ]
}
```

---

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. å†…å­˜æ³„éœ²ä¿®å¤çš„æ·±å±‚åŽŸå› 
- React useEffect ä¾èµ–ï¼šåªæœ‰ä¾èµ–é¡¹å˜åŒ–æ‰ä¼šé‡æ–°æ‰§è¡Œ
- LangChain æ¨¡åž‹ç¼“å­˜ï¼šæ¨¡åž‹å®žä¾‹å¯èƒ½ä¿ç•™å†…éƒ¨çŠ¶æ€
- è§£å†³æ€è·¯ï¼šå¼ºåˆ¶é‡å»ºè€Œéžè½¯é‡ç½®

### 2. æ‹–åŠ¨åŠŸèƒ½å®žçŽ°è¦ç‚¹
- `PanResponder` ç”¨äºŽæ‰‹åŠ¿è¯†åˆ«
- `Animated.ValueXY` ç”¨äºŽä½ç½®è¿½è¸ª
- åŒºåˆ†ç‚¹å‡»å’Œæ‹–åŠ¨ï¼šåˆ¤æ–­ç§»åŠ¨è·ç¦»
- è¾¹ç•Œæ£€æŸ¥ï¼šé˜²æ­¢æ‹–å‡ºå±å¹•

### 3. AI æç¤ºè¯å·¥ç¨‹
- æ˜Žç¡®æŒ‡ä»¤ï¼šä½¿ç”¨"å¿…é¡»"ç­‰å¼ºåˆ¶æ€§è¯æ±‡
- å…·ä½“åŒ–ï¼šç»™å‡ºæ•°é‡èŒƒå›´ï¼ˆ2-4 ä¸ªï¼‰
- è´¨é‡è¦æ±‚ï¼šå¼ºè°ƒ"å…·ä½“ã€å¯æ“ä½œ"

---

## æµ‹è¯•å»ºè®®

### 1. å†…å­˜æ³„éœ²æµ‹è¯•
```
æ­¥éª¤ï¼š
1. å¯¹è¯ Aï¼šè®°ä¸€ç¬”"åˆé¤ 15 å…ƒ"
2. åˆ‡æ¢åˆ°æ–°å¯¹è¯ B
3. é—®ï¼š"æˆ‘ä¹‹å‰è®°å½•äº†ä»€ä¹ˆï¼Ÿ"
æœŸæœ›ï¼šAI å›žç­”"æˆ‘æ— æ³•æŸ¥çœ‹æ‚¨ä¹‹å‰çš„è®°å½•"
```

### 2. æ‹–åŠ¨åŠŸèƒ½æµ‹è¯•
```
æ­¥éª¤ï¼š
1. å¯åŠ¨ Agent ä»»åŠ¡ï¼ˆä¾‹å¦‚"åˆ†æžå¼€æ”¯"ï¼‰
2. åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢ï¼Œè§‚å¯Ÿæ‚¬æµ®æŒ‰é’®
3. é•¿æŒ‰æŒ‰é’®æ‹–åŠ¨åˆ°ä¸åŒä½ç½®
4. è½»è§¦æŒ‰é’®ï¼ˆä¸æ‹–åŠ¨ï¼‰
æœŸæœ›ï¼šæ‹–åŠ¨æ—¶æŒ‰é’®è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨ï¼Œè½»è§¦æ—¶å¯¼èˆªåˆ° Agent é¡µé¢
```

### 3. æ™ºèƒ½å»ºè®®æµ‹è¯•
```
æ­¥éª¤ï¼š
1. æ‰§è¡Œä»»æ„ Agent ä»»åŠ¡ï¼ˆå¦‚"æŸ¥è¯¢æœ¬æœˆäº¤æ˜“"ï¼‰
2. è§‚å¯Ÿè¿”å›žç»“æžœ
æœŸæœ›ï¼šç»“æžœå¡ç‰‡ä¸‹æ–¹æ˜¾ç¤º 2-4 ä¸ªæ“ä½œå»ºè®®æŒ‰é’®
```

---

## æ€§èƒ½å½±å“è¯„ä¼°

### 1. Agent é‡å»ºçš„æ€§èƒ½å¼€é”€
- **å½±å“èŒƒå›´**ï¼šä»…åœ¨åˆ‡æ¢å¯¹è¯æ—¶è§¦å‘
- **å¼€é”€**ï¼šæ¨¡åž‹å®žä¾‹åˆ›å»ºï¼ˆçº¦ 50-100msï¼‰
- **æ”¶ç›Š**ï¼šå½»åº•è§£å†³å†…å­˜æ³„éœ²é—®é¢˜ï¼ŒèŠ‚çœ token æˆæœ¬
- **ç»“è®º**ï¼šå¼€é”€å¯æŽ¥å—ï¼Œæ”¶ç›Šè¿œå¤§äºŽæˆæœ¬

### 2. æ‹–åŠ¨åŠŸèƒ½çš„æ€§èƒ½
- **å®žçŽ°æ–¹å¼**ï¼š`Animated` APIï¼ˆåŽŸç”Ÿæ€§èƒ½ï¼‰
- **å¸§çŽ‡**ï¼š60 FPSï¼ˆå¹³æ»‘ä½“éªŒï¼‰
- **å†…å­˜**ï¼šæ–°å¢žçº¦ 1KBï¼ˆposition stateï¼‰
- **ç»“è®º**ï¼šæ€§èƒ½å½±å“æžå°

### 3. æ™ºèƒ½å»ºè®®çš„ Token æ¶ˆè€—
- **é¢å¤–æ¶ˆè€—**ï¼šæ¯æ¬¡å“åº”çº¦å¢žåŠ  50-100 tokens
- **æ”¶ç›Š**ï¼šæå‡ç”¨æˆ·ä½“éªŒï¼Œå‡å°‘ç”¨æˆ·æ€è€ƒæ—¶é—´
- **ç»“è®º**ï¼šToken å¢žåŠ åˆç†ï¼Œç”¨æˆ·ä½“éªŒæå‡æ˜¾è‘—

---

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **æ‹–åŠ¨ä½ç½®æŒä¹…åŒ–**ï¼šä¿å­˜ç”¨æˆ·æœ€åŽçš„æ‹–åŠ¨ä½ç½®åˆ° AsyncStorage
2. **å»ºè®®è´¨é‡ä¼˜åŒ–**ï¼šæ ¹æ®ç”¨æˆ·ç‚¹å‡»çŽ‡ä¼˜åŒ–å»ºè®®ç®—æ³•
3. **Agent æ± ç®¡ç†**ï¼šè€ƒè™‘ä½¿ç”¨å¯¹è±¡æ± å‡å°‘é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¼€é”€

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»åž‹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| `src/context/AgentContext.tsx` | ä¿®å¤ | ~10 è¡Œ |
| `src/components/agent/AgentFloatingButton.tsx` | æ–°å¢žåŠŸèƒ½ | ~60 è¡Œ |
| `src/agent/statefulAgent.ts` | ä¼˜åŒ– | ~5 è¡Œ |

---

## ä½œè€…è¯´æ˜Ž

æ‰€æœ‰ä¿®å¤å·²é€šè¿‡ TypeScript ç±»åž‹æ£€æŸ¥ï¼Œæ— ç¼–è¯‘é”™è¯¯ã€‚

ä¿®å¤æ—¥æœŸï¼š2025-12-12
ä¿®å¤ç‰ˆæœ¬ï¼šv1.0.0
