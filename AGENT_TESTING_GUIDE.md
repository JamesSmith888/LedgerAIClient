# Agent åŠŸèƒ½æµ‹è¯•æŒ‡å—

## æµ‹è¯•å‡†å¤‡

1. **ç¡®ä¿åç«¯è¿è¡Œ**: `ledger-server` éœ€è¦åœ¨è¿è¡ŒçŠ¶æ€
2. **ç”¨æˆ·å·²ç™»å½•**: éœ€è¦æœ‰æœ‰æ•ˆçš„ token
3. **è‡³å°‘æœ‰ä¸€ä¸ªè´¦æœ¬**: ç”¨æˆ·è´¦æˆ·ä¸­æœ‰è´¦æœ¬æ•°æ®

## æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1: ä¸Šä¸‹æ–‡è‡ªåŠ¨è·å–
**ç›®çš„**: éªŒè¯ AI èƒ½å¤Ÿè‡ªåŠ¨è·å–å½“å‰è´¦æœ¬ä¿¡æ¯

**æµ‹è¯•æ­¥éª¤**:
1. æ‰“å¼€ Agent èŠå¤©ç•Œé¢
2. å‘é€æ¶ˆæ¯: "æˆ‘å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸ªè´¦æœ¬?"

**é¢„æœŸç»“æœ**:
```
ğŸ“‹ [Agent] Available tools: get_user_info, get_current_ledger, ...
ğŸ”§ [Agent] Found 1 tool call(s):
  1. get_current_ledger {}
ğŸ” [getCurrentLedgerTool] Called
```

AI åº”è¯¥ç›´æ¥å›ç­”è´¦æœ¬åç§°,ä¸ä¼šé—®ä½ "è¯·å‘Šè¯‰æˆ‘è´¦æœ¬ID"ã€‚

### æµ‹è¯• 2: åˆ›å»ºäº¤æ˜“(ä¸æä¾›è´¦æœ¬ID)
**ç›®çš„**: éªŒè¯ AI èƒ½å¤Ÿè‡ªåŠ¨ä½¿ç”¨å½“å‰è´¦æœ¬åˆ›å»ºäº¤æ˜“

**æµ‹è¯•æ­¥éª¤**:
1. å‘é€æ¶ˆæ¯: "å¸®æˆ‘è®°å½•ä¸€ç¬”åˆé¤æ”¯å‡º50å…ƒ"

**é¢„æœŸç»“æœ**:
```
ğŸ”§ [createTransactionTool] Called with: { name: "åˆé¤", amount: 50, type: "EXPENSE" }
ğŸ“ [createTransactionTool] ledgerId not provided, fetching from current ledger
âœ… [createTransactionTool] Using current ledger ID: 1
ğŸ“¤ [createTransactionTool] Sending request: { ledgerId: 1, ... }
```

äº¤æ˜“åº”è¯¥æˆåŠŸåˆ›å»º,ä¸ä¼šæç¤º"ç¼ºå°‘è´¦æœ¬ID"ã€‚

### æµ‹è¯• 3: ä½¿ç”¨åˆ†ç±»åç§°åˆ›å»ºäº¤æ˜“
**ç›®çš„**: éªŒè¯ AI èƒ½å¤Ÿé€šè¿‡åˆ†ç±»åç§°æŸ¥è¯¢åˆ†ç±»ID

**æµ‹è¯•æ­¥éª¤**:
1. å‘é€æ¶ˆæ¯: "è®°å½•ä¸€ç¬”äº¤é€šè´¹ç”¨30å…ƒ,åˆ†ç±»æ˜¯äº¤é€š"

**é¢„æœŸç»“æœ**:
```
ğŸ“ [createTransactionTool] Searching category by name: äº¤é€š
âœ… [createTransactionTool] Found category: äº¤é€š (ID: X)
```

å¦‚æœæ‰¾åˆ°åŒ¹é…çš„åˆ†ç±»,åº”è¯¥è‡ªåŠ¨ä½¿ç”¨;å¦‚æœæ²¡æ‰¾åˆ°,ä¼šåˆ›å»ºæ²¡æœ‰åˆ†ç±»çš„äº¤æ˜“ã€‚

### æµ‹è¯• 4: æŸ¥è¯¢äº¤æ˜“(ä¸æä¾›è´¦æœ¬ID)
**ç›®çš„**: éªŒè¯æŸ¥è¯¢æ—¶è‡ªåŠ¨ä½¿ç”¨å½“å‰è´¦æœ¬

**æµ‹è¯•æ­¥éª¤**:
1. å‘é€æ¶ˆæ¯: "ä»Šå¤©æˆ‘æœ‰å“ªäº›æ”¯å‡º?"

**é¢„æœŸç»“æœ**:
```
ğŸ”§ [queryTransactionsTool] Called with: { type: "EXPENSE", ... }
ğŸ“ [queryTransactionsTool] ledgerId not provided, fetching from current ledger
âœ… [queryTransactionsTool] Using current ledger ID: 1
```

åº”è¯¥æ˜¾ç¤ºå½“å‰è´¦æœ¬çš„æ”¯å‡ºè®°å½•ã€‚

### æµ‹è¯• 5: è·å–åˆ†ç±»åˆ—è¡¨
**ç›®çš„**: éªŒè¯ API æŸ¥è¯¢å·¥å…·

**æµ‹è¯•æ­¥éª¤**:
1. å‘é€æ¶ˆæ¯: "è¿™ä¸ªè´¦æœ¬æœ‰å“ªäº›åˆ†ç±»?"

**é¢„æœŸç»“æœ**:
```
ğŸ”§ [Agent] Found 2 tool call(s):
  1. get_current_ledger {}
  2. get_categories { ledgerId: 1 }
ğŸ” [getCategoriesToolByLedgerId] Fetching categories for ledger 1
âœ… [getCategoriesToolByLedgerId] Found X categories
```

åº”è¯¥åˆ—å‡ºæ‰€æœ‰åˆ†ç±»åŠå…¶ç±»å‹ã€‚

### æµ‹è¯• 6: å®Œæ•´å¯¹è¯æµç¨‹
**ç›®çš„**: éªŒè¯å¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ä¿æŒ

**æµ‹è¯•æ­¥éª¤**:
1. "æˆ‘æœ‰å“ªäº›è´¦æœ¬?" (åº”è¯¥åˆ—å‡ºæ‰€æœ‰è´¦æœ¬)
2. "å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸ª?" (åº”è¯¥è¯´æ˜å½“å‰è´¦æœ¬)
3. "å¸®æˆ‘è®°å½•ä¸€ç¬”æ”¯å‡º" (åº”è¯¥è¯¢é—®è¯¦æƒ…)
4. "ä¹°èœèŠ±äº†100å…ƒ" (åº”è¯¥åˆ›å»ºäº¤æ˜“)
5. "æŸ¥è¯¢ä¸€ä¸‹ä»Šå¤©çš„æ”¯å‡º" (åº”è¯¥æ˜¾ç¤ºåˆšåˆ›å»ºçš„äº¤æ˜“)

**é¢„æœŸç»“æœ**:
æ¯ä¸ªé—®é¢˜éƒ½åº”è¯¥æ­£ç¡®å›ç­”,å¹¶ä¸” AI èƒ½å¤Ÿè®°ä½ä¹‹å‰çš„ä¸Šä¸‹æ–‡ã€‚

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å®Œæ•´æ—¥å¿—
åœ¨ React Native è°ƒè¯•å™¨æˆ– Metro bundler æ§åˆ¶å°æŸ¥çœ‹:
- ğŸ¤– Agent åˆå§‹åŒ–
- ğŸ”„ è¿­ä»£è¿‡ç¨‹
- ğŸ”§ å·¥å…·è°ƒç”¨
- ğŸ“¤ğŸ“¥ è¯·æ±‚å’Œå“åº”

### 2. æ£€æŸ¥ä¸Šä¸‹æ–‡æ›´æ–°
å½“åˆ‡æ¢è´¦æœ¬æˆ–ç”¨æˆ·ä¿¡æ¯å˜åŒ–æ—¶,åº”è¯¥çœ‹åˆ°:
```
ğŸ”„ [AgentScreen] Updating agent context
ğŸ”„ [ContextTools] Context updated: { ... }
```

### 3. éªŒè¯å·¥å…·ç»‘å®š
Agent å¯åŠ¨æ—¶åº”è¯¥çœ‹åˆ°:
```
ğŸ¤– [Agent] Initializing with 10 tools
ğŸ“‹ [Agent] Available tools: get_user_info, get_current_ledger, ...
```

ç¡®ä¿åŒ…å«æ‰€æœ‰é¢„æœŸçš„å·¥å…·ã€‚

### 4. æ£€æŸ¥é”™è¯¯å¤„ç†
å¦‚æœå·¥å…·è°ƒç”¨å¤±è´¥,åº”è¯¥çœ‹åˆ°æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯:
```
âŒ [createTransactionTool] Error: ...
```

è€Œä¸æ˜¯ç¨‹åºå´©æºƒã€‚

## å¸¸è§é—®é¢˜

### Q: AI è¿˜æ˜¯åœ¨é—®æˆ‘è´¦æœ¬ID?
**A**: æ£€æŸ¥:
1. AgentScreen æ˜¯å¦æ­£ç¡®è°ƒç”¨äº† `updateAgentContext`
2. æ§åˆ¶å°æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡æ›´æ–°æ—¥å¿—
3. `get_current_ledger` å·¥å…·æ˜¯å¦åœ¨å·¥å…·åˆ—è¡¨ä¸­

### Q: åˆ†ç±»åç§°æœç´¢ä¸å·¥ä½œ?
**A**: æ£€æŸ¥:
1. åç«¯ `/api/categories/ledger/{ledgerId}` æ¥å£æ˜¯å¦æ­£å¸¸
2. åˆ†ç±»åç§°æ˜¯å¦å­˜åœ¨
3. äº¤æ˜“ç±»å‹(INCOME/EXPENSE)æ˜¯å¦åŒ¹é…

### Q: æ—¥å¿—å¤ªå¤š,çœ‹ä¸æ¸…?
**A**: å¯ä»¥ä¸´æ—¶æ³¨é‡Šéƒ¨åˆ†æ—¥å¿—,æˆ–ä½¿ç”¨è¿‡æ»¤:
```typescript
// åªçœ‹ Agent ä¸»æµç¨‹
console.log ç­›é€‰ "[Agent]"

// åªçœ‹ç‰¹å®šå·¥å…·
console.log ç­›é€‰ "[createTransactionTool]"
```

### Q: å·¥å…·è°ƒç”¨å¾ˆæ…¢?
**A**: 
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. åç«¯æ¥å£å“åº”æ—¶é—´
3. Google AI API å¯èƒ½åœ¨æŸäº›åœ°åŒºè¾ƒæ…¢

## æ€§èƒ½åŸºå‡†

æ­£å¸¸æƒ…å†µä¸‹:
- ä¸Šä¸‹æ–‡å·¥å…·è°ƒç”¨: < 10ms (æœ¬åœ°)
- API å·¥å…·è°ƒç”¨: 100-500ms (å–å†³äºç½‘ç»œ)
- äº¤æ˜“åˆ›å»º: 200-800ms
- LLM å“åº”: 1-3ç§’

å¦‚æœè¶…è¿‡è¿™äº›æ—¶é—´,éœ€è¦æ£€æŸ¥ç½‘ç»œæˆ–åç«¯æ€§èƒ½ã€‚

## ä¸‹ä¸€æ­¥æµ‹è¯•

1. **å‹åŠ›æµ‹è¯•**: å¿«é€Ÿè¿ç»­å‘é€å¤šæ¡æ¶ˆæ¯
2. **è¾¹ç•Œæµ‹è¯•**: 
   - æ²¡æœ‰è´¦æœ¬æ—¶çš„è¡Œä¸º
   - æ— æ•ˆçš„åˆ†ç±»åç§°
   - è¶…å¤§é‡‘é¢
3. **é”™è¯¯æ¢å¤**: ç½‘ç»œä¸­æ–­åçš„æ¢å¤
4. **å¤šè´¦æœ¬åˆ‡æ¢**: åˆ‡æ¢è´¦æœ¬åä¸Šä¸‹æ–‡æ˜¯å¦æ­£ç¡®æ›´æ–°
